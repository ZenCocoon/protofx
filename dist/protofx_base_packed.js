FX={};FX.Transition={swing:function(B,C,A,E,D){return((-Math.cos(C/D*Math.PI)/2)+0.5)*E+A}};FX.DefaultOptions={duration:500,transition:FX.Transition.swing,eventNotifier:document,memoData:null};FX.Base=Class.create((function(){function A(T){this.options=Object.extend(Object.clone(FX.DefaultOptions),T);this.currentTime=null;this.nextTime=0;this.playing=false;this.backward=false;this.cycle=false;this.callbacks={onEnded:Prototype.emptyFunction,onStarted:Prototype.emptyFunction,onBeforeStarted:Prototype.emptyFunction,onCycleEnded:Prototype.emptyFunction,onRewinded:Prototype.emptyFunction};this.setOptions(T)}function K(T){Object.extend(this.options,T||{});return this}function R(){return this.options.duration}function E(){return this.playing}function D(){return this.backward}function N(U,V,T){T=U=="backAndForth"?((T===false||T=="false")?false:true):((T==undefined||T===true||T=="true")?true:false);this.cycle=U=="none"?false:{type:U,count:V||1,back:T,current:0,direction:1};return this}function Q(){return this.cycle?this.cycle.current:(this.backward?1:0)}function M(){if(this.playing){return }this.fire("beforeStarted");this.playing=true;if(this.currentTime==null){this.currentTime=this.backward?this.getDuration():0;this.startAnimation(this.backward)}FX.Metronome.register(this);this.fire("started");return this}function I(){this.fire("stopped");FX.Metronome.unregister(this);this.playing=false;return this}function F(){this.fire("reversed");if(this.cycle){this.cycle.direction*=-1}this.backward=!this.backward;return this}function G(){this.stop();if(this.cycle.type=="loop"&&this.cycle.back==false){this.updateAnimation(this.cycle.direction<0?this.cycle.count:-1*this.cycle.current)}else{this.updateAnimation(this.backward?1:0)}this.currentTime=null;if(this.cycle){this.cycle.current=this.backward?this.cycle.count:0}this.fire("rewinded");return this}function B(U){this.currentTime+=this.backward||this.cycle.direction<0?-U:U;if(this.currentTime>this.getDuration()||this.currentTime<0){this.currentTime=this.currentTime<0?0:this.getDuration();this.updateAnimation(this.currentTime/this.getDuration());if(this.cycle){if(this.cycle.type=="loop"){this.cycle.current+=this.cycle.direction;this.fire("cycleEnded");this.cycle.back?this.updateAnimation(this.backward?1:0):this.startAnimation(this.backward);this.currentTime=this.backward?this.getDuration():0}else{if(this.cycle.type=="backAndForth"){this.cycle.direction*=-1;if((this.backward!=this.cycle.back&&this.cycle.direction>0)||(this.backward==this.cycle.back&&this.cycle.direction<0)){this.cycle.current+=this.backward?-1:1;this.fire("cycleEnded")}}}if(this.cycle.count=="unlimited"||(0<=this.cycle.current&&this.cycle.current<this.cycle.count)){return }}this.stopAnimation();FX.Metronome.unregister(this);this.currentTime=null;this.playing=false;this.fire("ended")}else{var T=this.options.transition(this.currentTime/this.getDuration(),this.currentTime,0,1,this.getDuration());this.updateAnimation(T)}}function L(T){this.callbacks.onEnded=T;return this}function S(T){this.callbacks.onStarted=T;return this}function J(T){this.callbacks.onBeforestarted=T;return this}function H(T){this.callbacks.onCycleended=T;return this}function C(T){this.callbacks.onRewinded=T;return this}function P(T){var U;if(U=this.callbacks["on"+T.capitalize()]){U(this)}this.options.eventNotifier.fire("fx:"+T,{fx:this,data:this.memoData})}function O(T){throw"FX.Base#updateAnimation(pos) must be implemented"}return{initialize:A,setOptions:K,setCycle:N,getCycle:Q,getDuration:R,play:M,stop:I,reverse:F,rewind:G,isPlaying:E,isBackward:D,metronomeUpdate:B,startAnimation:Prototype.emptyFunction,stopAnimation:Prototype.emptyFunction,updateAnimation:O,fire:P,onStarted:S,onEnded:L,onBeforeStarted:J,onCycleEnded:H,onRewinded:C}})());FX.Attribute=Class.create((function(){function F(M,O,N){this.key=M;this.from=O;this.to=N;this.type=B(this.from);this.unit=D(this.from);this.fromFX=E(this.from,this.isColor());this.toFX=A(this)}function H(P){if(this.isNumber()){return I(this.fromFX,this.toFX,P)+this.unit}else{var O=parseInt(I(this.fromFX[0],this.toFX[0],P));var N=parseInt(I(this.fromFX[1],this.toFX[1],P));var M=parseInt(I(this.fromFX[2],this.toFX[2],P));return"rgb("+O+", "+N+", "+M+")"}}function G(O,N){if(O&&this.relative){this.from=O}this.fromFX=E(this.from,this.isColor());this.relative=false;this.toFX=A(this,N);if(N&&this.relative){var M=this.fromFX;this.fromFX=this.toFX,this.toFX=M}}function C(){return this.type=="Color"}function L(){return this.type=="Number"}function B(M){if(Object.isString(M)&&M.isColor()){return"Color"}else{return"Number"}}function D(N){var M;if(Object.isString(N)&&(M=N.match(/(\d+)([\w\%]*)/))){return M[2]}else{return""}}function E(N,M){if(M){return N.getRGB()}else{if(Object.isString(N)){return parseFloat(N)}else{return N}}}function A(M,N){if(M.isColor()){return M.to.getRGB()}else{if(Object.isString(M.to)){if(K(M.to)){return J(M,N)}else{return parseFloat(M.to)}}else{return M.to}}}function I(O,N,M){return O+(N-O)*M}function K(M){return M.match(/^([\+\-\*\/]=)(\d*)$/)}function J(N,O){N.relative=true;var M=K(N.to);if((O&&M[1]=="-=")||(!O&&M[1]=="+=")){return N.fromFX+parseFloat(M[2])}else{if((O&&M[1]=="+=")||(!O&&M[1]=="-=")){return N.fromFX-parseFloat(M[2])}else{if((O&&M[1]=="*=")||(!O&&M[1]=="/=")){return N.fromFX/parseFloat(M[2])}else{if((O&&M[1]=="/=")||(!O&&M[1]=="*=")){return N.fromFX*parseFloat(M[2])}else{throw"Operator "+M[1]+" not allowed"}}}}}return{initialize:F,convert:H,reset:G,isNumber:L,isColor:C}})());FX.Metronome=(function(){var A=null,F=1000/60,C=null,I=new Array();function H(K){if(!J(K)){I.push(K);B()}}function E(K){I=I.reject(function(L){return L==K});if(I.length==0){G()}}function J(K){return I.find(function(L){return L==K})}function B(){if(A==null){C=new Date().getTime();A=setInterval(D,F);D()}}function G(){if(A){clearInterval(A);A=null;C=0}}function D(){var K=new Date().getTime();var L=K-C;C=K;I.invoke("metronomeUpdate",L)}return{register:H,unregister:E,isRegistered:J}})();Object.extend(String.prototype,{isColor:function(){return this.match(/^\#/)||this.match(/^rgb\(/)},getRGB:function(){function B(C){if(C.length==1){C+=C}return parseInt(C,16)}if(this.isColor()){var A;if(A=this.match(/(^rgb\()(\d+), (\d+), (\d+)(\))/i)){return[parseInt(A[2]),parseInt(A[3]),parseInt(A[4])]}if(A=this.match(/^\#([0-9a-f]{1})([0-9a-f]{1})([0-9a-f]{1})$/i)){return A.slice(1).collect(B)}if(A=this.match(/^\#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i)){return A.slice(1).collect(B)}}return null}});FX.Element=Class.create(FX.Base,(function(){function A($super,H,G){$super(G);this.element=$(H)}function D(G){this.originalAttributes=G;return this}function C(G){var H=new FX.Element(G,this.options).animate(this.originalAttributes);H.callbacks=this.callbacks;return H}function B(G){this.attributes=this.attributes||E(this.originalAttributes,this.element);this.attributes.each(function(H){H.reset(this.element.getStyle(H.key),G)},this)}function F(H){var G={};this.attributes.each(function(I){G[I.key]=I.convert(H)},this);this.element.setStyle(G)}function E(G,H){var I=[];$H(G).each(function(J){I.push(new FX.Attribute(J.key,H.getStyle(J.key),J.value))});return I}return{initialize:A,animate:D,cloneFor:C,startAnimation:B,updateAnimation:F}})());Element.addMethods({fade:function(B,A){if(!(B=$(B))){return }new FX.Element(B).setOptions(A||{}).animate({opacity:0}).play();return B},appear:function(B,A){if(!(B=$(B))){return }new FX.Element(B).setOptions(A||{}).animate({opacity:1}).play();return B},blindUp:function(B,A){if(!(B=$(B))){return }if(!B.visible()||B.fx_blindUp){return B}B.fx_blindUp=new FX.Element(B).setOptions(A||{}).onBeforeStarted(function(){B.originalHeight=B.style.height}).onEnded(function(){B.hide();B.style.height=B.originalHeight;delete B.fx_blindUp}).animate({height:0}).play();return B},blindDown:function(C,B){if(!(C=$(C))){return }if(C.visible()||C.fx_blindDown){return C}var A=C.getHeight();C.fx_blindDown=new FX.Element(C).setOptions(B||{}).onBeforeStarted(function(){C.show();C.style.height="0px"}).onEnded(function(){delete C.fx_blindDown}).animate({height:A+"px"}).play();return C},highlight:function(B,A){if(!(B=$(B))){return }if(!B.visible()){return B}if(B.fx_highlight){B.fx_highlight.stop().reverse().rewind()}A=A||{};var D=A.highlightColor||"#ffff99";var C=B.getStyle("background-color");B.fx_highlight=new FX.Element(B).setOptions(A).animate({backgroundColor:C}).onBeforeStarted(function(){B.setStyle({backgroundColor:D})}).onEnded(function(){delete B.fx_highlight}).play();return B},shake:function(C,B){if(!(C=$(C))){return }if(!C.visible()){return C}if(C.fx_shake){C.fx_shake.stop().reverse().rewind()}var B=Object.extend({duration:50},B||{});var D=B.distance||20;var A=Object.clone(B);A.duration*=2;C.makePositioned();C.fx_shake=new FX.Element(C).setOptions(B).animate({left:"+="+D}).onEnded(function(){new FX.Element(C).setOptions(A).animate({left:"-="+D*2}).onEnded(function(){new FX.Element(C).setOptions(B).animate({left:"+="+D}).onEnded(function(){C.undoPositioned();delete C.fx_shake}).play()}).play()}).play();return C},pulsate:function(C,A){if(!(C=$(C))){return }if(!C.visible()){return C}A=Object.extend({duration:2000},A||{});if(C.fx_pulsate){C.fx_pulsate.isBackward()?C.fx_pulsate.stop().reverse().rewind():C.fx_pulsate.stop().rewind()}var B=A.pulses||5;A.duration=A.duration/(B*2);C.fx_pulsate=new FX.Element(C).setOptions(A).setCycle("backAndForth",B,true).onEnded(function(){delete C.fx_pulsate}).animate({opacity:0}).play();return C}});