FX={};FX.Transition={swing:function(B,C,A,E,D){return((-Math.cos(C/D*Math.PI)/2)+0.5)*E+A}};FX.DefaultOptions={duration:500,transition:FX.Transition.swing};FX.Base=Class.create((function(){function E(L){this.options=Object.clone(FX.DefaultOptions);this.currentTime=null;this.nextTime=0;this.isPlaying=false;this.backward=false;this.setOptions(L)}function H(L){Object.extend(this.options,L||{});return this}function J(){return this.options.duration}function B(){if(this.isPlaying){return }this.isPlaying=true;if(this.currentTime==null){this.currentTime=this.backward?this.getDuration():0;this.startAnimation(this.backward)}FX.Metronome.register(this);return this}function I(){FX.Metronome.unregister(this);this.isPlaying=false;return this}function G(){this.backward=!this.backward;return this}function C(){this.stop();this.updateAnimation(this.backward?1:0);this.currentTime=null;return this}function K(M){this.currentTime+=this.backward?-M:M;if(this.currentTime>this.getDuration()||this.currentTime<0){this.updateAnimation(this.currentTime<0?0:1);this.stopAnimation();FX.Metronome.unregister(this);this.currentTime=null;this.isPlaying=false}else{var L=this.options.transition(this.currentTime/this.getDuration(),this.currentTime,0,1,this.getDuration());this.updateAnimation(L)}}function F(L){}function A(){}function D(L){throw"FX.Base#updateAnimation(pos) must be implemented"}return{initialize:E,setOptions:H,getDuration:J,play:B,stop:I,reverse:G,rewind:C,metronomeUpdate:K,startAnimation:F,stopAnimation:A,updateAnimation:D}})());FX.Attribute=Class.create((function(){function F(M,O,N){this.key=M;this.from=O;this.to=N;this.type=B(this.from);this.unit=D(this.from);this.fromFX=E(this.from,this.isColor());this.toFX=A(this)}function H(P){if(this.isNumber()){return I(this.fromFX,this.toFX,P)+this.unit}else{var O=parseInt(I(this.fromFX[0],this.toFX[0],P));var N=parseInt(I(this.fromFX[1],this.toFX[1],P));var M=parseInt(I(this.fromFX[2],this.toFX[2],P));return"rgb("+O+", "+N+", "+M+")"}}function G(O,N){if(O&&this.relative){this.from=O}this.fromFX=E(this.from,this.isColor());this.relative=false;this.toFX=A(this,N);if(N&&this.relative){var M=this.fromFX;this.fromFX=this.toFX,this.toFX=M}}function C(){return this.type=="Color"}function L(){return this.type=="Number"}function B(M){if(Object.isString(M)&&M.isColor()){return"Color"}else{return"Number"}}function D(N){var M;if(Object.isString(N)&&(M=N.match(/(\d+)([\w\%]*)/))){return M[2]}else{return""}}function E(N,M){if(M){return N.getRGB()}else{if(Object.isString(N)){return parseFloat(N)}else{return N}}}function A(M,N){if(M.isColor()){return M.to.getRGB()}else{if(Object.isString(M.to)){if(K(M.to)){return J(M,N)}else{return parseFloat(M.to)}}else{return M.to}}}function I(O,N,M){return O+(N-O)*M}function K(M){return M.match(/^([\+\-\*\/]=)(\d*)$/)}function J(N,O){N.relative=true;var M=K(N.to);if((O&&M[1]=="-=")||(!O&&M[1]=="+=")){return N.fromFX+parseFloat(M[2])}else{if((O&&M[1]=="+=")||(!O&&M[1]=="-=")){return N.fromFX-parseFloat(M[2])}else{if((O&&M[1]=="*=")||(!O&&M[1]=="/=")){return N.fromFX/parseFloat(M[2])}else{if((O&&M[1]=="/=")||(!O&&M[1]=="*=")){return N.fromFX*parseFloat(M[2])}else{throw"Operator "+M[1]+" not allowed"}}}}}return{initialize:F,convert:H,reset:G,isNumber:L,isColor:C}})());FX.Metronome=(function(){var A=null,F=1000/60,C=null,I=new Array();function H(K){if(!J(K)){I.push(K);B()}}function E(K){I=I.reject(function(L){return L==K});if(I.length==0){G()}}function J(K){return I.find(function(L){return L==K})}function B(){if(A==null){C=new Date().getTime();A=setInterval(D,F);D()}}function G(){if(A){clearInterval(A);A=null;C=0}}function D(){var K=new Date().getTime();var L=K-C;C=K;I.invoke("metronomeUpdate",L)}return{register:H,unregister:E,isRegistered:J}})();Object.extend(String.prototype,{isColor:function(){return this.match(/^\#/)||this.match(/^rgb\(/)},getRGB:function(){function B(C){if(C.length==1){C+=C}return parseInt(C,16)}if(this.isColor()){var A;if(A=this.match(/(^rgb\()(\d+), (\d+), (\d+)(\))/i)){return[parseInt(A[2]),parseInt(A[3]),parseInt(A[4])]}if(A=this.match(/^\#([0-9a-f]{1})([0-9a-f]{1})([0-9a-f]{1})$/i)){return A.slice(1).collect(B)}if(A=this.match(/^\#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i)){return A.slice(1).collect(B)}}return null}});FX.Element=Class.create(FX.Base,(function(){function A($super,H,G){$super(G);this.element=$(H)}function D(G){this.attributes=this.element?E(G,this.element):G;return this}function C(G){return new FX.Element(G,this.options).animate(this.attributes)}function B(G){this.attributes.each(function(H){H.reset(this.element.getStyle(H.key),G)},this)}function F(H){var G={};this.attributes.each(function(I){G[I.key]=I.convert(H)},this);this.element.setStyle(G)}function E(G,H){var I=[];$H(G).each(function(J){I.push(new FX.Attribute(J.key,H.getStyle(J.key),J.value))});return I}return{initialize:A,animate:D,cloneFor:C,startAnimation:B,updateAnimation:F}})());